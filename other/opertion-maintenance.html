<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux 运维 | Billow&#39;s Blog</title>
    <meta name="description" content="Record the life">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/logo.png">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.c0a7e688.css" as="style"><link rel="preload" href="/assets/js/app.22954aa2.js" as="script"><link rel="preload" href="/assets/js/4.add35840.js" as="script"><link rel="preload" href="/assets/js/3.427e9326.js" as="script"><link rel="preload" href="/assets/js/34.f3d049d9.js" as="script"><link rel="prefetch" href="/assets/js/10.e7932f30.js"><link rel="prefetch" href="/assets/js/11.1f571763.js"><link rel="prefetch" href="/assets/js/12.0461003d.js"><link rel="prefetch" href="/assets/js/13.f5d001eb.js"><link rel="prefetch" href="/assets/js/14.0f3a0436.js"><link rel="prefetch" href="/assets/js/15.a0497f0b.js"><link rel="prefetch" href="/assets/js/16.ff107bf4.js"><link rel="prefetch" href="/assets/js/17.035e8731.js"><link rel="prefetch" href="/assets/js/18.01094233.js"><link rel="prefetch" href="/assets/js/19.877f6d14.js"><link rel="prefetch" href="/assets/js/20.714d13f8.js"><link rel="prefetch" href="/assets/js/21.9351b853.js"><link rel="prefetch" href="/assets/js/22.414e6bbb.js"><link rel="prefetch" href="/assets/js/23.dd2e1270.js"><link rel="prefetch" href="/assets/js/24.0fa8a240.js"><link rel="prefetch" href="/assets/js/25.1f79c268.js"><link rel="prefetch" href="/assets/js/26.c85a6468.js"><link rel="prefetch" href="/assets/js/27.fc774c16.js"><link rel="prefetch" href="/assets/js/28.77a244b4.js"><link rel="prefetch" href="/assets/js/29.7c842a86.js"><link rel="prefetch" href="/assets/js/30.3b341bef.js"><link rel="prefetch" href="/assets/js/31.cf1cf75a.js"><link rel="prefetch" href="/assets/js/32.8a37ac97.js"><link rel="prefetch" href="/assets/js/33.f3db3e06.js"><link rel="prefetch" href="/assets/js/35.0403648c.js"><link rel="prefetch" href="/assets/js/36.f6c57d27.js"><link rel="prefetch" href="/assets/js/37.2bc661c7.js"><link rel="prefetch" href="/assets/js/38.f17264dc.js"><link rel="prefetch" href="/assets/js/5.6d825eed.js"><link rel="prefetch" href="/assets/js/6.603f538b.js"><link rel="prefetch" href="/assets/js/7.cb63a6fa.js"><link rel="prefetch" href="/assets/js/8.5f00453f.js"><link rel="prefetch" href="/assets/js/9.5ad32179.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.b83442b7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c0a7e688.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Billow's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/archive/" class="nav-link">
  存档
</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/back-end/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">
  其他技术
</a></div><div class="nav-item"><a href="/notebook/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/archive/" class="nav-link">
  存档
</a></div><div class="nav-item"><a href="/front-end/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/back-end/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/other/" class="nav-link router-link-active">
  其他技术
</a></div><div class="nav-item"><a href="/notebook/" class="nav-link">
  笔记
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="yum-源配置"><a href="#yum-源配置" class="header-anchor">#</a> yum 源配置</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/yum.repos.d
<span class="token function">cp</span> rhel-source.repo  test.repo
<span class="token function">vi</span> test.repo
<span class="token builtin class-name">cd</span> /media/RHEL_6.2<span class="token punctuation">\</span> i386<span class="token punctuation">\</span> Disc<span class="token punctuation">\</span> <span class="token number">1</span>/<span class="token punctuation">(</span>enabled<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
yum clean all
yum makecache
</code></pre></div> <h3 id="源代码编译安装"><a href="#源代码编译安装" class="header-anchor">#</a> 源代码编译安装</h3> <ol><li>解包
. 习惯上将软件包释放到<code>/usr/src/目录</code>
. 解包后的源代码文件位置：<code>/usr/src/软件名-版本号/</code>
. 命令<code>tar xf httpd-2.2.17.tar.gz -C /usr/src</code></li> <li>预配置
· 使用源码目录中的 configure 脚本
· 执行<code>./configure –help</code>可查看帮助
· 典型的配置选项：
--prefix=软件安装目录</li> <li>编译
· 执行 make 命令
·示例：<code>[root@www httpd-2.2.17]# make</code></li> <li>安装
·执行<code>make install</code>命令
·示例<code>[root@www httpd-2.2.17]# make install</code></li></ol> <h3 id="管理-lvm-逻辑卷"><a href="#管理-lvm-逻辑卷" class="header-anchor">#</a> 管理 LVM 逻辑卷</h3> <div class="language- extra-class"><pre class="language-text"><code>1. Linux 中将硬盘等设备均表示为文件 (`/dev/sd[bcde][12345]`),所有硬件都是通过挂载实现。
2. 硬盘中的主分区数目只有 4 个，因此主分区和扩展分区的序号也就限制在 1~4。扩展分 区再分为逻辑分区，逻辑分区的序号始终从 5 开始。
3. 检测并确认新硬盘 `fdisk –l` 
Id：分区对应的系统 ID 号。
    83 表示 Linux 中的 EXT4 分区
    8e 表示 LVM 逻辑卷
    82 表 示 swap
    fd 表示 RAID 
4. 使用 fdisk 进行分区 `fdisk /dev/sdb` 、`partprobe`可以检测硬盘是否安装成功
5. 分区完之后需要对分区进行格式化 `mkfs -t ext4 /dev/sdb1`
6. `mount`  查看当前的挂载 `mount –a`  挂载`/etc/fstab` 中已记录的所有挂载（开机自动挂载需要将内容写在这个文件里）
7. `df -hT` 查看磁盘使用状况
8. `PV====》VG====》LV`
    . `[root@www ~]# pvcreate /dev/sd[bcde]1`
    . `[root@www ~]# vgcreate vg0 /dev/sd[bcde]1`
    . `[root@www ~]# lvcreate -L 20G -n lv0 vg0 ` 
    . 扩展逻辑卷 lvextend 命令 `lvextend –L +大小或直接写增加后的最终大小 /dev/卷组名/逻辑卷名`(记得先扩展vgextend ,不记得就查man 手册)
    调整（刷新）逻辑卷分区大小`resize2fs /dev/vg0/lv0 `
（这里需要对谁格式化？？？）
</code></pre></div><h3 id="磁盘冗余阵列-磁盘恢复"><a href="#磁盘冗余阵列-磁盘恢复" class="header-anchor">#</a> 磁盘冗余阵列 磁盘恢复</h3> <ol><li>这里需要先对硬盘进行分区（三个主分区，其他为扩展分区）</li> <li><code>mdadm -Cv /dev/md5 -l5 -n3 -x1 /dev/sd[bcde]1</code>(RAID5 3个存储，一个校验)</li> <li><code>mkfs.ext4 /dev/md5</code>（格式化,之前不需要格式化）</li> <li><code>[root@www ~]# mkdir /xuexi [root@www ~]# mount /dev/md5 /xuexi/</code></li> <li>手动创建 RAID 配置文件 <code>/etc/mdadm.conf [root@www ~]# mdadm -D -s &gt; /etc/mdadm.conf</code> vi /etc/mdadm.conf 并在文件尾加 auto=yes</li> <li>模拟/dev/sdb1 硬盘损坏，将其拔出后再插入
<code>[root@www ~]# mdadm /dev/md5 -f /dev/sdb1</code>
mdadm: set /dev/sdb1 faulty in /dev/md5
<code>[root@www ~]# cat /proc/mdstat</code> <code>[root@www ~]# mdadm /dev/md5 -r /dev/sdb1</code>
mdadm: hot removed /dev/sdb1 from /dev/md5
<code>[root@www ~]# mdadm /dev/md5 -a /dev/sdb1</code>
mdadm: added /dev/sdb1
[root@www ~]# cat /proc/mdstat</li> <li>RAID 的拉伸
添加一块新硬盘<code>/dev/sdf</code>并创建sdf1分区 在添加到RAID5中作为热备盘
<code>[root@www ~]# mdadm /dev/md5 -a /dev/sdf1</code>
mdadm: added /dev/sdf1
<code>[root@www ~]# mdadm -G /dev/md5 -n 4</code> <code>[root@www ~]# cat /proc/mdstat</code></li></ol> <h3 id="关闭linux防火墙"><a href="#关闭linux防火墙" class="header-anchor">#</a> 关闭Linux防火墙</h3> <ol><li>重启后生效
开启： <code>chkconfig iptables on</code>
关闭： <code>chkconfig iptables off</code></li> <li>即时生效，重启后失效
开启： <code>service iptables start</code>
关闭： <code>service iptables stop</code></li></ol> <h3 id="关闭selinux"><a href="#关闭selinux" class="header-anchor">#</a> 关闭selinux</h3> <ol><li>永久关闭，重启后生效
<code>vim /etc/sysconfig/selinux</code>
把SELINUX=enforcing 改为 SELINUX=disabled</li> <li>临时关闭SELinux
<code>setenforce 0</code></li></ol> <h3 id="lamp-架构搭建"><a href="#lamp-架构搭建" class="header-anchor">#</a> LAMP 架构搭建</h3> <p>Apache（httpd）+ Mysql + PHP</p> <h4 id="httpd-conf配置问题"><a href="#httpd-conf配置问题" class="header-anchor">#</a> httpd.conf配置问题</h4> <div class="language- extra-class"><pre class="language-text"><code>1、解压 httpd 源码包，释放到/usr/src/目录下
2、[root@www httpd-2.2.17]# ./configure --prefix=/usr/local/httpd --enable-so   --enable-rewrite --enable-charset-lite --enable-cgi &amp;&amp;make &amp;&amp; make install
3、优化执行路径
    通过源码包编译安装的 httpd 服务，程序路径并不在默认的搜索路径中，为了使该服务 在使用时更加方便，可以为相关程序添加符号链接（软链接）到/usr/local/bin 下
    [root@www ~]# ln -s /usr/local/httpd/bin/* /usr/local/bin/
4、添加 httpd 系统服务
    [root@www ~]# cp /usr/local/httpd/bin/apachectl /etc/init.d/httpd
    [root@www ~]# chmod +x /etc/init.d/httpd
    在**/etc/init.d/httpd**文件开头里面加上
    #chkconfig: 35 85 21 
    #description: Startup script for the Apache HTTP Server
    [root@www ~]# chkconfig --add httpd
    [root@www ~]# chkconfig --list httpd
5、配置并启用 httpd 服务 修改/usr/local/httpd/conf/httpd.conf 主配置文件

</code></pre></div><h4 id="mysql配置问题"><a href="#mysql配置问题" class="header-anchor">#</a> mysql配置问题</h4> <div class="language- extra-class"><pre class="language-text"><code>1. MySQL 5.5 需要 cmake 编译安装，所以先安装 cmake 包 
    [root@www ~]# tar xf cmake-2.8.6.tar.gz -C /usr/src/ 
    [root@www ~]# cd /usr/src/cmake-2.8.6/
    [root@www cmake-2.8.6]# ./configure &amp;&amp; gmake &amp;&amp; gmake install
2. 创建 MySQL 的用户和组
    [root@www ~]# groupadd mysql
    [root@www ~]# useradd -M -s /sbin/nologin -g mysql mysql
3. 编译安装
    [root@www ~]# cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql
    -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci
    -DWITH_EXTRA_CHARSETS=all -DSYSCONFDIR=/etc &amp;&amp; make &amp;&amp; make install
4. 一些其他问题 如nginx 添加软连接或者环境变量
    ln -s /usr/local/nginx/sbin/nginx /usr/local/bin/nginx
</code></pre></div><h4 id="php配置问题"><a href="#php配置问题" class="header-anchor">#</a> php配置问题</h4> <div class="language- extra-class"><pre class="language-text"><code>1、准备工作（安装 yum install zlib-devel libxml2-devel）
2、安装扩展工具库（数据加密工具 libmcrypt、mhash、mcrypt）
    其中mcrypt 安装方式比较特别，解压之后，
    export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
    之后预编译安装 ./configure &amp;&amp; make &amp;&amp; make install

3、编译安装 PHP
    [root@www ~]# tar xf php-5.3.28.tar.gz -C /usr/src [root@www ~]# cd /usr/src/php-5.3.28/
    [root@www php-5.3.28]# ./configure --prefix=/usr/local/php5 --with-mcrypt
    --with-apxs2=/usr/local/httpd/bin/apxs --with-mysql=/usr/local/mysql
    --with-config-file-path=/usr/local/php5 --enable-mbstring &amp;&amp; make &amp;&amp; make install
4、建立主配置文件 php.ini，并进行调整
    [root@www php-5.3.28] # cp php.ini-development /usr/local/php5/php.ini
    修改 php.ini 文件将 226 行 OFF 改为 On 784行 字符集改为utf-8
5、添加 ZendGuardLoader 优化模块
    解压之后到达 php-5.3.x 目录
    将ZendGuardLoader.so 拷贝到 /usr/local/php5/lib/php/
    让后再php.ini末尾追加zend_extension=/usr/local/php5/lib/php/ZendGuardLoader.so
    zend.loader.enable=1
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/20/2020, 2:09:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.22954aa2.js" defer></script><script src="/assets/js/4.add35840.js" defer></script><script src="/assets/js/3.427e9326.js" defer></script><script src="/assets/js/34.f3d049d9.js" defer></script>
  </body>
</html>
